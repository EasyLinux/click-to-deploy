actions:

- name: Create key-value pair
  bashTest:
    script: |-
      timeout 120 bash -c '
        until (curl -X POST -d 'bar' 'http://{{ .Env.APP_INSTANCE_NAME }}-svc:5701/hazelcast/rest/maps/mapName/foo'); do
          echo Trying to set bar...
          sleep 2;
        done'
    expect:
      exitCode:
        equals: 0

- name: Get key-value pair
  bashTest:
    script: |-
      timeout 120 bash -c '
        until (curl -s -X GET 'http://{{ .Env.APP_INSTANCE_NAME }}-svc:5701/hazelcast/rest/maps/mapName/foo' | grep 'bar'); do
          echo Trying to get bar...
          sleep 2;
        done'
    expect:
      exitCode:
        equals: 0

- name: Test metrics
  bashTest:
    script: |-
      curl -v GET 'http://{{ .Env.APP_INSTANCE_NAME }}-svc:8080/'
    expect:
      stdout:
        contains: 'process_start_time_seconds'
